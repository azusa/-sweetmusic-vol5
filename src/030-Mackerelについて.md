
\lhead[]{}
\rhead[]{}
\chead[Mackerelについて]{Mackerelについて}

# Mackerelについて

「Mackerel」は、株式会社はてなが提供する、
サーバー監視サービスです。

ユーザーインターフェースはWeb上で提供されており、
https://mackerel.io からアクセスすることができます。

Mackerelとは魚の「鯖」を指す英単語です。サービス名称としての「Mackerel」は、「サーバー」のことを指して「鯖」と俗称するという日本のIT業界の風習にちなんでいます。 ^[はてなの開発現場をForkwell Jobsのおおかゆかさんが探る！ “エンジニアの価値”を上げるインタビューとは - はてなニュース　[http://hatenanews.com/articles/201412/23091](http://hatenanews.com/articles/201412/23091)]

Mackerelは直感的な設定が可能なユーザーインターフェースを最たる特徴とします。

それに加えて、筆者はMackerelを使用するうえでサービスを特徴付けるポイントとして、以下の三点を挙げます。導入の容易さ、プラグイン開発の容易さ、課金体系の三点です。

## 導入の容易さ

Mackerelは監視対象となるホストにmackerel-agentというエージェントを導入することによってセットアップします。セットアップは、ホスト上でワンライナーを実行することで行うことができます。

このワンライナーのスクリプトの実行が完了した時点で、CPU使用率など、ホストに対する基本的な項目の監視が行えるようになっています。

## プラグイン開発の容易さ

Mackerelではプラグインを導入することにより、ミドルウェアやサービス全体を対象とした監視項目を追加することができます。

また、プラグインを開発することにより、自らのニーズに応じたカスタムメトリックやチェック監視の項目を追加することができます。

この際、実行するコマンドの返り値と標準出力を用いてメトリックの送信を行うので、
特定のプログラミング言語によらずにプラグインの開発を行う事ができます。


## 課金体系

Mackerelの料金プランはホスト数により課金されるStandardプランと、Freeプランに分かれています。^[[https://mackerel.io/ja/pricing/](https://mackerel.io/ja/pricing/)]

Freeプランはホスト数、一部機能(外形監視、カスタムダッシュボード、グラフ表示期間など)の
制約を受けますが、単体のホストのホストメトリックの監視については制限がほぼなく、
エンジニアが個人で機能を検証することによる、草の根レベルからの普及が行いやすいプラン体系になっています。

なお、新規にオーガニゼーション(後述)を作成して2週間はTrialプランとして
全ての機能を制限なく使用できます。

## 用語について

ここでは、Mackerelを特徴づける概念をあらわす用語とその意味について、
説明を行います。

- オーガニゼーション

Mackerelにアカウントを所有するユーザーはサービス全体で一つのアカウントを使用します。

Mackerelでは監視を行う対象の単位として「オーガニゼーション」という
ものがあり、Mackerelのユーザーはこのオーガニゼーションに所属することになります。

またユーザーは、複数のオーガニゼーションに所属することが可能です。

Mackerelでは通常は組織単位ではなく、ITサービスやシステムの単位でオーガニゼーションを構成します。これは、業務委託先に所属するユーザーや、エンドユーザーなど、
運営主体と異なる組織のユーザーをオーガニゼーションに参加可能にするためです。

- ホストとエージェント

Mackerelでは監視対象となるホストにmackerel-agentと呼ばれるエージェントをインストールし、そのエージェントがmackerelのサービスを提供するサーバーと通信を行う事でメトリクスの収集を行います。

Mackerelでは、一ヶ月でのアクティブ ^[通常、mackerel-agentの起動数] なホスト数の移動平均でホスト数を算出し、 ^[[https://mackerel.io/ja/docs/entry/faq/contracts/calculate-host-number](https://mackerel.io/ja/docs/entry/faq/contracts/calculate-host-number)]、算出したホスト数が課金の単位となります。

また、プランごとの各種項目数がプラン上限を超えている場合、ホスト数として換算して課金を行います。^[[https://mackerel.io/ja/docs/entry/faq/contracts/limit-exceeded-conversion](https://mackerel.io/ja/docs/entry/faq/contracts/limit-exceeded-conversion)]

なお課金プランの詳細については、サービス運営元の株式会社はてなにお問い合わせください。

- メトリック

mackerel-agentが収集するホストの様々なホストの状況をメトリックと呼びます。メトリクス
とも呼ばれますが、Mackerelのサービスにおいてはメトリックと呼ばれるため、本書でもメトリックという呼び方で統一します。^[[https://mackerel.io/ja/docs/entry/glossary](https://mackerel.io/ja/docs/entry/glossary)]

- サービス

Mackerelにおいて、ホストを管理する最上位の階層をサービスと呼びます。

サービス内で「アプリケーション」「Web」「データベース」などのロールに分かれたホスト群が
あわさって一つのサービスを構成します。

- ロール

ロールはサービスに所属するホストをさらにその「役割」によって分類する概念です。

オートスケールや「Infrastructure as Code」などの、インフラに関する自動化の進展により、ホストは動的に増減を行うようになり、ホストやコンテナーを入れ替える形式でのデプロイも一般的となりました。

Mackerelでは、動的に増減するホストを「データベース」や「Webサーバー」などの
役割によってグルーピングし、グラフ内で重ね合わせて可視化することができます。


