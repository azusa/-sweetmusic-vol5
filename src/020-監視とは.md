\lhead[]{}
\rhead[]{}
\chead[なぜゆえの監視]{なぜゆえの監視}

# なぜゆえの監視

平家物語の歌い出しに「諸行無常の響きあり」という言い回しがありますが、
どれだけ完璧なサイジングをしたとしても、ITサービスを取り巻く周囲の環境の
変化は、サーバーやネットワーク帯域などのインフラのレイヤーに様々な
影響を及ぼし、パフォーマンスの低下やレイテンシーの増大など、サービス品質に影響を与える問題を引き起こします。

サービス運用を考えるにあたって、ユーザーは増えるものであり、データは貯まるものであり、アプリケーションの規模は膨らむものです。

現代では、クラウドに代表される仮想化技術の進展により、インフラに関する
リソースは以前に比べるとはるかに容易に調達ができるようになってきました。しかし、インフラにかかるコストと事業の収益性は比例するものではないということを考えると、インフラにかかる費用を青天井で計上するということもまた非現実的です。

情報処理の世界には「Measure Don't Guess.」(推測するな、計測せよ)や、「計測なくして改善なし」などの格言がありますが、これらの言葉の根底には19世紀のフランスの数学者Jules-Henri Poincarの「計測なくして科学なし」という言葉があります。

パフォーマンスチューニングとは測定した事象と仮説検証について行う、れっきとしたエンジニアリングの一分野であり、単に「設定値を増やせばいい」というものではありません。ネットワークを通じて結びつく、システム上の各機器のパラメーターを調整する上では、個別の機器のパラメーターの変動がシステム全体にどのような影響を及ぼすかという視点が欠かせません。

そのためには、システムのリソースの使用状況や、プログラム実行時のエラーの状況など、

## 誰のためのモニタリング

ITサービスの運用に当たっては開発、インフラ構築、運用など、様々な利害関係者が存在します。その中で運用に関わる主体は、システムを安定して運用することを使命としています。

システムインテグレーションの分野では、開発が完了してカットオーバーされてもユーザーがいないシステムというものが間々ありますが、これは運用の立場からすると、理想的なシステムです。なぜなら、ユーザーがいないシステムはユーザーへのサービス提供に影響をおよぼす障害をおこすことがないからです。

これは極端な例ですが、自らのタスクがキューからあふれているシステム運用者は、「システムをいかに使用させないか」という思考パターンに陥ることがあります。

しかし、ITサービスの構成要素としてのシステムはユーザーの使用に供するために存在するということであり、その意味では、アラームが発生するということは、システムが使われて社会のために役に立っていると言うことの証しです。

「10+ Deploys Per Day」[@Allspaw2009] で「Opsの仕事は、ビジネスを実現することだ」 (Ops' Jobs is to enable the business) とある通り、ITサービス運用の存在意義は、システムの安定運用を通じてビジネス価値を実現することと、サービスを取り巻く環境の変化に対応するために、柔軟なインフラ基盤の提供を実現することにあります。

しかしながら、ITサービス運用というのはシステムを作る側でなく預かる側です。運用(インフラ)が仕事がないことは望ましいことであり、実際運用が暇なくらいでないと、安定運用のための足場づくりというのは不可能です。ですが「システムの使用を促進する」ことと、「自分の仕事を減らす」という二点を両立させることは言うは易く行うは難しの最たる例です。

システムの安定運用と、運用業務の省力化の二つの観点の最適化という観点から監視を考えた場合に留意すべき事は、監視の対象となる項目は、詳細にしようとすればいくらでも細かくできるということです。

ハードウェアのリソースやOSのモジュールの動作状況、ネットワークの使用状況など、監視する項目は際限なく増やすことができます。発生確率が一定なら監視項目が増えるということはアラームが発生する回数が増えるということです。

そのアラームを受けるのはシフトで夜勤をしている運用メンバーであり、そしてアラームを受け取ることから始まるストレスと負のフィードバックはやがてDevとOpsの対立を引き起こします。

監視をすることその事態は目的ではなく、安定したサービス運用のために手段として行うものです。我々はサービスの監視を行いたいわけであってOSの監視を行いたいわけではないわけです。

その際の監視の対象の主となるものは、ユーザーに対するサービス提供が正常かどうかであり、ハードウェアやOS、そしてアプリケーションの細かい状態への監視はそれを補完するものです。

## 監視にもとめられるもの

以上のことを踏まえた上で、監視を行うシステムに求められるものは、以下の三点があげられます。

### 最小限度のカスタマイズで使用することができること

### 機能と学習コストのバランスがとれていること


### 既定値のバランスがとれていること

以上を踏まえて、本書では上記を実現するための方策として、サーバー監視サービスであるMackerelを紹介します。




